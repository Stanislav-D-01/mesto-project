(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{w4:()=>C,AQ:()=>w,OP:()=>j});var t={formSelector:".popup__form",inputSelector:".popup__input-field",submitButtonSelector:".popup__button-save",inactiveButtonClass:"popup__button-save_type_disable",inputErrorClass:"input-field_type_error",errorClass:"input-error_active"};function o(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent="",r.classList.remove(o),t.classList.remove(n)}function n(e,n,c,a){var s=Array.from(e.querySelectorAll(n)),u=e.querySelector(c);s.forEach((function(n){o(e,n,t.errorClass,t.inputErrorClass)})),r(u),u.classList.add(a)}function r(e){e.disabled=!0}var c=document.querySelectorAll(".popup");function a(e){e.classList.add("popup_opened"),document.addEventListener("keydown",u)}function s(){document.querySelector(".popup_opened").classList.remove("popup_opened"),document.removeEventListener("keydown",u)}function u(e){"Escape"===e.key&&s()}var i=document.querySelector(".cards"),l={baseUrl:"https://nomoreparties.co/v1/plus-cohort-19/users/me",headers:{authorization:"2c7584da-c4c4-46ef-a185-6ffbe2e069d4"}},d="",p=document.querySelector("#newMesto"),f=document.querySelector(".add-mesto-popup"),m=document.querySelector("input[name=name-new-mesto]"),h=document.querySelector("input[name=link-new-mesto]"),v=document.querySelector(".popup-views-img"),_=document.querySelector(".popup__img"),y=document.querySelector(".popup__name-img");function S(e,t,o,n,r,c){o.prepend(function(e,t,o,n,r){var c=p.content.cloneNode(!0),s=c.querySelector(".cards__image"),u=c.querySelector(".cards__like"),i=c.querySelector(".cards__num-likes"),f=c.querySelector(".cards__delete");if(s.src=t,s.alt=e,c.querySelector(".cards__title").textContent=e,i.textContent=n.length,n.length>0)for(var m=0;m<n.length;m++)if(n[m]._id==d){u.classList.add("cards__like_active");break}return r==d&&f.classList.add("cards__delete_visible"),u.addEventListener("click",(function(e){u.matches(".cards__like_active")?function(e,t,o){fetch("https://nomoreparties.co/v1/plus-cohort-19/cards/likes/".concat(o),{method:"DELETE",headers:l.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка:%{res.status}")})).then((function(o){t.textContent=o.likes.length,e.target.classList.remove("cards__like_active")})).catch((function(e){console.log(e)}))}(e,i,o):function(e,t,o){fetch("https://nomoreparties.co/v1/plus-cohort-19/cards/likes/".concat(o),{method:"PUT",headers:l.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка:%{res.status}")})).then((function(o){t.textContent=o.likes.length,e.target.classList.add("cards__like_active")})).catch((function(e){console.log(e)}))}(e,i,o)})),c.querySelector(".cards__delete").addEventListener("click",(function(e){!function(e,t){fetch("https://nomoreparties.co/v1/plus-cohort-19/cards/".concat(t),{method:"DELETE",headers:l.headers}).then((function(t){if(!t.ok)return Promise.reject("Ошибка:%{res.status}");e.target.parentElement.remove()})).catch((function(e){console.log(e)}))}(e,o)})),c.querySelector(".cards__image").addEventListener("click",(function(o){_.src=t,_.alt=e,y.textContent=e,a(v)})),c}(e,t,n,r,c))}var C=document.querySelector("form[name=add-new-mesto]"),q=document.querySelector(".profile__add-button"),k=document.querySelector(".profile__edit-button"),b=document.querySelectorAll(".popup__icon-close"),g=document.querySelector('form[name="edit-user"]'),L=(f.querySelector(".popup__button-save"),document.querySelector(".profile__user-name")),E=document.querySelector(".profile__user-about"),j=document.querySelector(".profile-popup"),x=document.querySelector("input[name=name-user]"),P=document.querySelector("input[name=about-user]"),w=document.querySelector(".avatar-popup"),A=document.querySelector("form[name=edit-avatar]"),B=A.querySelector("input[name=input-link-avatar]"),T=document.querySelector(".profile__avatar"),O=document.querySelector(".profile__button-avatar-edit");!function(e){function t(t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(o.disabled=!1,o.classList.remove(e.inactiveButtonClass)):(r(o),o.classList.add(e.inactiveButtonClass))}Array.from(document.querySelectorAll(e.formSelector)).forEach((function(n){!function(n){var r=Array.from(n.querySelectorAll(e.inputSelector)),c=n.querySelector(e.submitButtonSelector);t(r,c),r.forEach((function(a){a.addEventListener("input",(function(){!function(t,n){n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),!1===n.validity.valid?function(e,t,o,n,r){var c=e.querySelector(".".concat(t.id,"-error"));c.textContent=o,c.classList.add(n),t.classList.add(r)}(t,n,n.validationMessage,e.errorClass,e.inputErrorClass):o(t,n,e.errorClass,e.inputErrorClass)}(n,a),t(r,c)}))}))}(n)}))}(t),c.forEach((function(e){e.addEventListener("click",(function(e){e.target.classList.contains("popup")&&s()}))})),function(e){e.textContent="Load...",fetch("https://nomoreparties.co/v1/plus-cohort-19/users/me",{headers:l.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка:%{res.status}")})).then((function(t){e.textContent=t.name,d=t._id,fetch("https://nomoreparties.co/v1/plus-cohort-19/cards",{headers:l.headers}).then((function(e){return console.log("okkk"),e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})).then((function(e){console.log("jr");for(var t=e.length,o=0;o<t;o++)S(e[t-o-1].name,e[t-o-1].link,i,e[t-o-1]._id,e[t-o-1].likes,e[t-o-1].owner._id)})).catch((function(e){console.log(e)}))})).catch((function(t){e.textContent="Ошибка загрузки имени ".concat(t)}))}(L),function(e){e.textContent="Load...",fetch("https://nomoreparties.co/v1/plus-cohort-19/users/me",{headers:l.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка:%{res.status}")})).then((function(t){e.textContent=t.about})).catch((function(t){e.textContent="Ошибка загрузки информации ".concat(t)}))}(E),function(e){fetch("https://nomoreparties.co/v1/plus-cohort-19/users/me",{headers:l.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка:%{res.status}")})).then((function(t){e.src=t.avatar})).catch((function(e){console.log("Ошибка загрузки аватара ".concat(e))}))}(T),g.addEventListener("submit",(function(e){e.preventDefault(),console.log("ok"),function(e,t,o,n,r){var c=o.querySelector(".popup__button-save");c.textContent="Сохранение...",fetch("https://nomoreparties.co/v1/plus-cohort-19/users/me",{method:"PATCH",headers:{authorization:l.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:e.value,about:t.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})).then((function(e){n.textContent=e.name,r.textContent=e.about,s()})).catch((function(e){console.log(e)})).finally((function(){return c.textContent="Сохранить"}))}(x,P,g,L,E)})),b.forEach((function(e){e.addEventListener("click",s)})),k.addEventListener("click",(function(){x.value=L.textContent,P.value=E.textContent,a(j),n(j,t.inputSelector,t.submitButtonSelector,t.inactiveButtonClass)})),q.addEventListener("click",(function(){m.value="",h.value="",a(f),n(f,t.inputSelector,t.submitButtonSelector,t.inactiveButtonClass)})),C.addEventListener("submit",(function(e){e.preventDefault(),function(e,t){var o=C.querySelector(".popup__button-save");o.textContent="Сохранение...",fetch("https://nomoreparties.co/v1/plus-cohort-19/cards",{method:"POST",headers:{authorization:l.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:e.value,link:t.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})).then((function(e){S(e.name,e.link,i,e._id,[],e.owner._id),s()})).catch((function(e){console.log(e)})).finally((function(){return o.textContent="Сохранить"}))}(m,h)})),O.addEventListener("click",(function(){B.value="",a(w),n(w,t.inputSelector,t.submitButtonSelector,t.inactiveButtonClass)})),A.addEventListener("submit",(function(e){e.preventDefault(),function(e,t,o){var n=e.querySelector(".popup__button-save");n.textContent="Сохранение...",fetch("https://nomoreparties.co/v1/plus-cohort-19/users/me/avatar",{method:"PATCH",headers:{authorization:l.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({avatar:t.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})).then((function(e){o.src=e.avatar,s()})).catch((function(e){console.log(e)})).finally((function(){return n.textContent="Сохранить"}))}(A,B,T)}))})();