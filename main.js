(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{hO:()=>M});var t={formSelector:".popup__form",inputSelector:".popup__input-field",submitButtonSelector:".popup__button-save",inactiveButtonClass:"popup__button-save_type_disable",inputErrorClass:"input-field_type_error",errorClass:"input-error_active"};function n(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));o.textContent="",o.classList.remove(n),t.classList.remove(r)}function r(e,r,a,c){var u=Array.from(e.querySelectorAll(r)),i=e.querySelector(a);u.forEach((function(r){n(e,r,t.errorClass,t.inputErrorClass)})),o(i),i.classList.add(c)}function o(e){e.disabled=!0}var a=document.querySelectorAll(".popup");function c(e){e.classList.add("popup_opened"),document.addEventListener("keydown",i)}function u(){document.querySelector(".popup_opened").classList.remove("popup_opened"),document.removeEventListener("keydown",i)}function i(e){"Escape"===e.key&&u()}function l(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}function s(e,t,n,r){r.textContent=n?e:t}var d={baseUrl:"https://nomoreparties.co/v1/plus-cohort-19/users/me",cardsUrl:"https://nomoreparties.co/v1/plus-cohort-19/cards",likesUrl:"https://nomoreparties.co/v1/plus-cohort-19/cards/likes",avatarUrl:"https://nomoreparties.co/v1/plus-cohort-19/users/me/avatar",headers:{authorization:"2c7584da-c4c4-46ef-a185-6ffbe2e069d4"}},f=document.querySelector("#newMesto"),p=document.querySelector(".add-mesto-popup"),m=document.querySelector("input[name=name-new-mesto]"),h=document.querySelector("input[name=link-new-mesto]"),v=document.querySelector(".cards"),y=document.querySelector(".popup-views-img"),_=document.querySelector(".popup__img"),S=document.querySelector(".popup__name-img");function b(e,t,n,r,o,a){n.prepend(function(e,t,n,r,o){var a=f.content.cloneNode(!0),u=a.querySelector(".cards__image"),i=a.querySelector(".cards__like"),s=a.querySelector(".cards__num-likes"),p=a.querySelector(".cards__delete");if(u.src=t,u.alt=e,a.querySelector(".cards__title").textContent=e,s.textContent=r.length,r.length>0)for(var m=0;m<r.length;m++)if(r[m]._id==M){i.classList.add("cards__like_active");break}return o==M&&p.classList.add("cards__delete_visible"),i.addEventListener("click",(function(e){i.matches(".cards__like_active")?function(e){return fetch("".concat(d.likesUrl,"/").concat(e),{method:"DELETE",headers:d.headers}).then((function(e){return l(e)}))}(n).then((function(t){s.textContent=t.likes.length,e.target.classList.remove("cards__like_active")})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(d.likesUrl,"/").concat(e),{method:"PUT",headers:d.headers}).then((function(e){return l(e)}))}(n).then((function(t){s.textContent=t.likes.length,e.target.classList.add("cards__like_active")})).catch((function(e){console.log(e)}))})),a.querySelector(".cards__delete").addEventListener("click",(function(e){(function(e){return fetch("".concat(d.cardsUrl,"/").concat(e),{method:"DELETE",headers:d.headers})})(n).then((function(t){if(!t.ok)return Promise.reject("Ошибка:%{res.status}");e.target.parentElement.remove()})).catch((function(e){console.log(e)}))})),a.querySelector(".cards__image").addEventListener("click",(function(n){_.src=t,_.alt=e,S.textContent=e,c(y)})),a}(e,t,r,o,a))}function q(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var g=document.querySelector("form[name=add-new-mesto]"),C=document.querySelector(".profile__add-button"),k=document.querySelector(".profile__edit-button"),E=document.querySelectorAll(".popup__icon-close"),L=document.querySelector('form[name="edit-user"]'),A=p.querySelector(".popup__button-save"),x=document.querySelector(".profile__user-name"),U=document.querySelector(".profile__user-about"),w=document.querySelector(".profile-popup"),j=document.querySelector("input[name=name-user]"),O=document.querySelector("input[name=about-user]"),B=document.querySelector(".avatar-popup"),T=document.querySelector("form[name=edit-avatar]"),P=T.querySelector("input[name=input-link-avatar]"),z=document.querySelector(".profile__avatar"),D=document.querySelector(".profile__button-avatar-edit"),M="",N={},I=L.querySelector(".popup__button-save"),J=B.querySelector(".popup__button-save");!function(e){function t(t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(n.disabled=!1,n.classList.remove(e.inactiveButtonClass)):(o(n),n.classList.add(e.inactiveButtonClass))}Array.from(document.querySelectorAll(e.formSelector)).forEach((function(r){!function(r){var o=Array.from(r.querySelectorAll(e.inputSelector)),a=r.querySelector(e.submitButtonSelector);t(o,a),o.forEach((function(c){c.addEventListener("input",(function(){!function(t,r){r.validity.patternMismatch?r.setCustomValidity(r.dataset.errorMessage):r.setCustomValidity(""),!1===r.validity.valid?function(e,t,n,r,o){var a=e.querySelector(".".concat(t.id,"-error"));a.textContent=n,a.classList.add(r),t.classList.add(o)}(t,r,r.validationMessage,e.errorClass,e.inputErrorClass):n(t,r,e.errorClass,e.inputErrorClass)}(r,c),t(o,a)}))}))}(r)}))}(t),a.forEach((function(e){e.addEventListener("click",(function(e){e.target.classList.contains("popup")&&u()}))})),Promise.all([fetch(d.baseUrl,{headers:d.headers}).then((function(e){return l(e)})),fetch(d.baseUrl,{headers:d.headers}).then((function(e){return l(e)})),fetch(d.cardsUrl,{headers:d.headers}).then((function(e){return l(e)}))]).then((function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,c,u=[],i=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=a.call(n)).done)&&(u.push(r.value),u.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{if(!i&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw o}}return u}}(e,t)||function(e,t){if(e){if("string"==typeof e)return q(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?q(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,3),n=t[0],r=t[1],o=t[2];x.textContent=n.name,U.textContent=n.about,M=n._id,z.src=r.avatar,N=o;for(var a=0;a<N.length;a++)b(N[N.length-a-1].name,N[N.length-a-1].link,v,N[N.length-a-1]._id,N[N.length-a-1].likes,N[N.length-a-1].owner._id)})).catch((function(e){return console.log(e)})),L.addEventListener("submit",(function(e){e.preventDefault(),s("Сохранение","Сохранить",!0,I),function(e,t){return fetch(d.baseUrl,{method:"PATCH",headers:{authorization:d.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:e.value,about:t.value})}).then((function(e){return l(e)}))}(j,O).then((function(e){x.textContent=e.name,U.textContent=e.about,u()})).catch((function(e){console.log(e)})).finally((function(){return s("Сохранение...","Сохранить",!1,I)}))})),E.forEach((function(e){e.addEventListener("click",u)})),k.addEventListener("click",(function(){j.value=x.textContent,O.value=U.textContent,c(w),r(w,t.inputSelector,t.submitButtonSelector,t.inactiveButtonClass)})),C.addEventListener("click",(function(){m.value="",h.value="",c(p),r(p,t.inputSelector,t.submitButtonSelector,t.inactiveButtonClass)})),g.addEventListener("submit",(function(e){e.preventDefault(),s("Сохранение...","Создать",!0,A),function(e,t){return fetch(d.cardsUrl,{method:"POST",headers:{authorization:d.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:e.value,link:t.value})}).then((function(e){return l(e)}))}(m,h).then((function(e){b(e.name,e.link,v,e._id,[],e.owner._id),u()})).catch((function(e){console.log(e)})).finally((function(){return s("Сохранение...","Создать",!1,A)}))})),D.addEventListener("click",(function(){P.value="",c(B),r(B,t.inputSelector,t.submitButtonSelector,t.inactiveButtonClass)})),T.addEventListener("submit",(function(e){e.preventDefault(),s("Сохранение...","Сохранить",!0,J),function(e){return fetch(d.avatarUrl,{method:"PATCH",headers:{authorization:d.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({avatar:e.value})}).then((function(e){return l(e)}))}(P).then((function(e){z.src=e.avatar,u()})).catch((function(e){console.log(e)})).finally((function(){return s("Сохранение...","Сохранить",!1,J)}))}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFNMEUsR0Z0RDdDLFNBQXNCTCxHQUMzQixPQUFPNUIsTUFBTXBDLEVBQU9JLFVBQVcsQ0FDN0JpQyxPQUFRLFFBQ1JoQyxRQUFTLENBQ1BDLGNBQWVOLEVBQU9LLFFBQVFDLGNBQzlCLGVBQWdCLG9CQUVsQjBGLEtBQU1DLEtBQUtDLFVBQVUsQ0FDbkJULE9BQVF6QixFQUFlbUMsVUFFeEI3RCxNQUFLLFNBQUNqRCxHQUNQLE9BQU9ELEVBQWNDLEVBQ3ZCLEdBQ0YsQ0UwQ0VrSCxDQUFhdkMsR0FDVjFCLE1BQUssU0FBQ0UsR0FDTHlCLEVBQVVwQyxJQUFNVyxFQUFLaUQsT0FDckJ4RyxHQUNGLElBQ0MwRCxPQUFNLFNBQUN0RCxHQUNOd0QsUUFBUUMsSUFBSXpELEVBQ2QsSUFDQ2dILFNBQVEsa0JBQ1AxRyxFQUFjLGdCQUFpQixhQUFhLEVBQU8wRSxFQUFpQixHQUUxRSxHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbWVzdG8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vbWVzdG8vd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL21lc3RvL3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vbWVzdG8vLi9zcmMvY29tcG9uZW50cy92YWxpZGF0ZS5qcyIsIndlYnBhY2s6Ly9tZXN0by8uL3NyYy9jb21wb25lbnRzL21vZGFsLmpzIiwid2VicGFjazovL21lc3RvLy4vc3JjL2NvbXBvbmVudHMvdXRpbHMuanMiLCJ3ZWJwYWNrOi8vbWVzdG8vLi9zcmMvY29tcG9uZW50cy9hcGkuanMiLCJ3ZWJwYWNrOi8vbWVzdG8vLi9zcmMvY29tcG9uZW50cy9jYXJkLmpzIiwid2VicGFjazovL21lc3RvLy4vc3JjL2NvbXBvbmVudHMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhlIHJlcXVpcmUgc2NvcGVcbnZhciBfX3dlYnBhY2tfcmVxdWlyZV9fID0ge307XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCJleHBvcnQgY29uc3QgdmFsaWRhdGlvblZhciA9IHtcbiAgZm9ybVNlbGVjdG9yOiBcIi5wb3B1cF9fZm9ybVwiLFxuICBpbnB1dFNlbGVjdG9yOiBcIi5wb3B1cF9faW5wdXQtZmllbGRcIixcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLnBvcHVwX19idXR0b24tc2F2ZVwiLFxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcInBvcHVwX19idXR0b24tc2F2ZV90eXBlX2Rpc2FibGVcIixcbiAgaW5wdXRFcnJvckNsYXNzOiBcImlucHV0LWZpZWxkX3R5cGVfZXJyb3JcIixcbiAgZXJyb3JDbGFzczogXCJpbnB1dC1lcnJvcl9hY3RpdmVcIixcbn07XG5leHBvcnQgZnVuY3Rpb24gZW5hYmxlVmFsaWRhdGlvbih2YWxpZGF0aW9uVmFyKSB7XG4gIGZvcm1WYWxpZGF0aW9uKCk7XG5cbiAgZnVuY3Rpb24gZm9ybVZhbGlkYXRpb24oKSB7XG4gICAgY29uc3QgZm9ybUxpc3QgPSBBcnJheS5mcm9tKFxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCh2YWxpZGF0aW9uVmFyLmZvcm1TZWxlY3RvcilcbiAgICApO1xuICAgIGZvcm1MaXN0LmZvckVhY2goKGZvcm1FbCkgPT4ge1xuICAgICAgYWRkRm9ybUxpc3RlbmVyKGZvcm1FbCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBhZGRGb3JtTGlzdGVuZXIoZm9ybUVsKSB7XG4gICAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcbiAgICAgIGZvcm1FbC5xdWVyeVNlbGVjdG9yQWxsKHZhbGlkYXRpb25WYXIuaW5wdXRTZWxlY3RvcilcbiAgICApO1xuICAgIGNvbnN0IGJ1dHRvbkVsID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3IodmFsaWRhdGlvblZhci5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XG4gICAgdG9nZ2xlQnV0dG9uKGlucHV0TGlzdCwgYnV0dG9uRWwpO1xuICAgIGlucHV0TGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChpbnB1dEVsKSB7XG4gICAgICBpbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICAgIGNoZWNrVmFsaWQoZm9ybUVsLCBpbnB1dEVsKTtcbiAgICAgICAgdG9nZ2xlQnV0dG9uKGlucHV0TGlzdCwgYnV0dG9uRWwpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBjaGVja1ZhbGlkKGZvcm1FbCwgaW5wdXRFbCkge1xuICAgIGlmIChpbnB1dEVsLnZhbGlkaXR5LnBhdHRlcm5NaXNtYXRjaCkge1xuICAgICAgaW5wdXRFbC5zZXRDdXN0b21WYWxpZGl0eShpbnB1dEVsLmRhdGFzZXQuZXJyb3JNZXNzYWdlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaW5wdXRFbC5zZXRDdXN0b21WYWxpZGl0eShcIlwiKTtcbiAgICB9XG4gICAgaWYgKGlucHV0RWwudmFsaWRpdHkudmFsaWQgPT09IGZhbHNlKSB7XG4gICAgICBzaG93SW5wdXRFcnIoXG4gICAgICAgIGZvcm1FbCxcbiAgICAgICAgaW5wdXRFbCxcbiAgICAgICAgaW5wdXRFbC52YWxpZGF0aW9uTWVzc2FnZSxcbiAgICAgICAgdmFsaWRhdGlvblZhci5lcnJvckNsYXNzLFxuICAgICAgICB2YWxpZGF0aW9uVmFyLmlucHV0RXJyb3JDbGFzc1xuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaGlkZUlucHV0RXJyKFxuICAgICAgICBmb3JtRWwsXG4gICAgICAgIGlucHV0RWwsXG4gICAgICAgIHZhbGlkYXRpb25WYXIuZXJyb3JDbGFzcyxcbiAgICAgICAgdmFsaWRhdGlvblZhci5pbnB1dEVycm9yQ2xhc3NcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gZmluZEludmFsaWRJbnB1dChpbnB1dExpc3QpIHtcbiAgICByZXR1cm4gaW5wdXRMaXN0LnNvbWUoKGlucHV0RWwpID0+ICFpbnB1dEVsLnZhbGlkaXR5LnZhbGlkKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHRvZ2dsZUJ1dHRvbihpbnB1dExpc3QsIGJ1dHRvbkVsKSB7XG4gICAgaWYgKGZpbmRJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xuICAgICAgZGlzYWJsZVN1Ym1pdEJ1dHRvbihidXR0b25FbCk7XG4gICAgICBidXR0b25FbC5jbGFzc0xpc3QuYWRkKHZhbGlkYXRpb25WYXIuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGJ1dHRvbkVsLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICBidXR0b25FbC5jbGFzc0xpc3QucmVtb3ZlKHZhbGlkYXRpb25WYXIuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHNob3dJbnB1dEVycihcbiAgZm9ybUVsLFxuICBpbnB1dEVsLFxuICBFcnJNZXNzYWdlLFxuICBjbGFzc0Vycm9yQWN0aXZlLFxuICBjbGFzc0lucHV0RXJyb3Jcbikge1xuICBjb25zdCBlcnJFbGVtZW50ID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0RWwuaWR9LWVycm9yYCk7XG4gIGVyckVsZW1lbnQudGV4dENvbnRlbnQgPSBFcnJNZXNzYWdlO1xuICBlcnJFbGVtZW50LmNsYXNzTGlzdC5hZGQoY2xhc3NFcnJvckFjdGl2ZSk7XG4gIGlucHV0RWwuY2xhc3NMaXN0LmFkZChjbGFzc0lucHV0RXJyb3IpO1xufVxuXG5mdW5jdGlvbiBoaWRlSW5wdXRFcnIoZm9ybUVsLCBpbnB1dEVsLCBjbGFzc0Vycm9yQWN0aXZlLCBjbGFzc0lucHV0RXJyb3IpIHtcbiAgY29uc3QgZXJyRWxlbWVudCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xuICBlcnJFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcbiAgZXJyRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzRXJyb3JBY3RpdmUpO1xuICBpbnB1dEVsLmNsYXNzTGlzdC5yZW1vdmUoY2xhc3NJbnB1dEVycm9yKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlc2V0RXJyb3IoXG4gIGZvcm1FbCxcbiAgaW5wdXRTZWxlY3RvcixcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3IsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3Ncbikge1xuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKGZvcm1FbC5xdWVyeVNlbGVjdG9yQWxsKGlucHV0U2VsZWN0b3IpKTtcbiAgY29uc3QgYnV0dG9uRWwgPSBmb3JtRWwucXVlcnlTZWxlY3RvcihzdWJtaXRCdXR0b25TZWxlY3Rvcik7XG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsKSA9PiB7XG4gICAgaGlkZUlucHV0RXJyKFxuICAgICAgZm9ybUVsLFxuICAgICAgaW5wdXRFbCxcbiAgICAgIHZhbGlkYXRpb25WYXIuZXJyb3JDbGFzcyxcbiAgICAgIHZhbGlkYXRpb25WYXIuaW5wdXRFcnJvckNsYXNzXG4gICAgKTtcbiAgfSk7XG4gIGRpc2FibGVTdWJtaXRCdXR0b24oYnV0dG9uRWwpO1xuICBidXR0b25FbC5jbGFzc0xpc3QuYWRkKGluYWN0aXZlQnV0dG9uQ2xhc3MpO1xufVxuXG5mdW5jdGlvbiBkaXNhYmxlU3VibWl0QnV0dG9uKGJ1dHRvbkVsZW1lbnQpIHtcbiAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XG59XG4iLCJjb25zdCBsaXN0UG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBvcHVwXCIpO1xuXG5leHBvcnQgZnVuY3Rpb24gb3BlblBvcHVwKHBvcHVwKSB7XG4gIHBvcHVwLmNsYXNzTGlzdC5hZGQoXCJwb3B1cF9vcGVuZWRcIik7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGNoZWNrS2V5RXNjYXBlKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNsb3NlUG9wdXAoKSB7XG4gIGNvbnN0IG9wZW5Qb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfb3BlbmVkXCIpO1xuXG4gIG9wZW5Qb3B1cC5jbGFzc0xpc3QucmVtb3ZlKFwicG9wdXBfb3BlbmVkXCIpO1xuICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBjaGVja0tleUVzY2FwZSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhZGRMaXN0ZW5lclBvcHVwKCkge1xuICBsaXN0UG9wdXAuZm9yRWFjaCgocG9wdXBFbCkgPT4ge1xuICAgIHBvcHVwRWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcbiAgICAgIGlmIChldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInBvcHVwXCIpKSB7XG4gICAgICAgIGNsb3NlUG9wdXAoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjaGVja0tleUVzY2FwZShldnQpIHtcbiAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICBjbG9zZVBvcHVwKCk7XG4gIH1cbn1cbiIsImV4cG9ydCBmdW5jdGlvbiBjaGVja1Jlc3BvbnNlKHJlcykge1xuICBpZiAocmVzLm9rKSB7XG4gICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGDQntGI0LjQsdC60LAgJHtyZXMuc3RhdHVzfWApO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZW5kZXJMb2FkaW5nKHRleHRMb2FkaW5nLCB0ZXN0U3RhbmRhcnQsIGJ1dHRvblN0YXR1cywgYnV0dG9uKSB7XG4gIGlmIChidXR0b25TdGF0dXMpIHtcbiAgICBidXR0b24udGV4dENvbnRlbnQgPSB0ZXh0TG9hZGluZztcbiAgfSBlbHNlIHtcbiAgICBidXR0b24udGV4dENvbnRlbnQgPSB0ZXN0U3RhbmRhcnQ7XG4gIH1cbn1cbiIsImltcG9ydCB7IGNoZWNrUmVzcG9uc2UgfSBmcm9tIFwiLi91dGlsc1wiO1xuXG5jb25zdCBjb25maWcgPSB7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9ub21vcmVwYXJ0aWVzLmNvL3YxL3BsdXMtY29ob3J0LTE5L3VzZXJzL21lXCIsXG4gIGNhcmRzVXJsOiBcImh0dHBzOi8vbm9tb3JlcGFydGllcy5jby92MS9wbHVzLWNvaG9ydC0xOS9jYXJkc1wiLFxuICBsaWtlc1VybDogXCJodHRwczovL25vbW9yZXBhcnRpZXMuY28vdjEvcGx1cy1jb2hvcnQtMTkvY2FyZHMvbGlrZXNcIixcbiAgYXZhdGFyVXJsOiBcImh0dHBzOi8vbm9tb3JlcGFydGllcy5jby92MS9wbHVzLWNvaG9ydC0xOS91c2Vycy9tZS9hdmF0YXJcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiMmM3NTg0ZGEtYzRjNC00NmVmLWExODUtNmZmYmUyZTA2OWQ0XCIsXG4gIH0sXG59O1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0VXNlckluZm8oKSB7XG4gIHJldHVybiBmZXRjaChjb25maWcuYmFzZVVybCwge1xuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzLFxuICB9KS50aGVuKChyZXMpID0+IHtcbiAgICByZXR1cm4gY2hlY2tSZXNwb25zZShyZXMpO1xuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGxvYWRBdmF0YXIoKSB7XG4gIHJldHVybiBmZXRjaChjb25maWcuYmFzZVVybCwge1xuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzLFxuICB9KS50aGVuKChyZXMpID0+IHtcbiAgICByZXR1cm4gY2hlY2tSZXNwb25zZShyZXMpO1xuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRlbGV0ZUxpa2UoY2FyZElkKSB7XG4gIHJldHVybiBmZXRjaChgJHtjb25maWcubGlrZXNVcmx9LyR7Y2FyZElkfWAsIHtcbiAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXG4gIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgIHJldHVybiBjaGVja1Jlc3BvbnNlKHJlcyk7XG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYWRkbGlrZShjYXJkSWQpIHtcbiAgcmV0dXJuIGZldGNoKGAke2NvbmZpZy5saWtlc1VybH0vJHtjYXJkSWR9YCwge1xuICAgIG1ldGhvZDogXCJQVVRcIixcbiAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVycyxcbiAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgcmV0dXJuIGNoZWNrUmVzcG9uc2UocmVzKTtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZWxldGVDYXJkKGNhcmRJZCkge1xuICByZXR1cm4gZmV0Y2goYCR7Y29uZmlnLmNhcmRzVXJsfS8ke2NhcmRJZH1gLCB7XG4gICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzLFxuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldENhcmRzKCkge1xuICByZXR1cm4gZmV0Y2goY29uZmlnLmNhcmRzVXJsLCB7XG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXG4gIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgIHJldHVybiBjaGVja1Jlc3BvbnNlKHJlcyk7XG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGF0Y2hQcm9maWxlKG5hbWVJbnB1dCwgYWJvdXRJbnB1dCkge1xuICByZXR1cm4gZmV0Y2goY29uZmlnLmJhc2VVcmwsIHtcbiAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICBoZWFkZXJzOiB7XG4gICAgICBhdXRob3JpemF0aW9uOiBjb25maWcuaGVhZGVycy5hdXRob3JpemF0aW9uLFxuICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgfSxcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICBuYW1lOiBuYW1lSW5wdXQudmFsdWUsXG4gICAgICBhYm91dDogYWJvdXRJbnB1dC52YWx1ZSxcbiAgICB9KSxcbiAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgcmV0dXJuIGNoZWNrUmVzcG9uc2UocmVzKTtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwb3N0TmV3Q2FyZChuYW1lTWVzdG9JbnB1dCwgbGlua01lc3RvSW5wdXQpIHtcbiAgcmV0dXJuIGZldGNoKGNvbmZpZy5jYXJkc1VybCwge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgaGVhZGVyczoge1xuICAgICAgYXV0aG9yaXphdGlvbjogY29uZmlnLmhlYWRlcnMuYXV0aG9yaXphdGlvbixcbiAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgIH0sXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgbmFtZTogbmFtZU1lc3RvSW5wdXQudmFsdWUsXG4gICAgICBsaW5rOiBsaW5rTWVzdG9JbnB1dC52YWx1ZSxcbiAgICB9KSxcbiAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgcmV0dXJuIGNoZWNrUmVzcG9uc2UocmVzKTtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZWxvYWRBdmF0YXIobmV3QXZhdGFySW5wdXQpIHtcbiAgcmV0dXJuIGZldGNoKGNvbmZpZy5hdmF0YXJVcmwsIHtcbiAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICBoZWFkZXJzOiB7XG4gICAgICBhdXRob3JpemF0aW9uOiBjb25maWcuaGVhZGVycy5hdXRob3JpemF0aW9uLFxuICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgfSxcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICBhdmF0YXI6IG5ld0F2YXRhcklucHV0LnZhbHVlLFxuICAgIH0pLFxuICB9KS50aGVuKChyZXMpID0+IHtcbiAgICByZXR1cm4gY2hlY2tSZXNwb25zZShyZXMpO1xuICB9KTtcbn1cbiIsImltcG9ydCB7IG9wZW5Qb3B1cCB9IGZyb20gXCIuL21vZGFsLmpzXCI7XG5pbXBvcnQgeyBkZWxldGVMaWtlLCBhZGRsaWtlLCBkZWxldGVDYXJkIH0gZnJvbSBcIi4vYXBpLmpzXCI7XG5pbXBvcnQgeyBpZFVzZXIgfSBmcm9tIFwiLi9pbmRleC5qc1wiO1xuY29uc3QgdGVtcGxhdGVOZXdNZXN0byA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbmV3TWVzdG9cIik7XG5leHBvcnQgY29uc3QgcG9wdXBBZGRNZXN0byA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuYWRkLW1lc3RvLXBvcHVwXCIpO1xuZXhwb3J0IGNvbnN0IG5hbWVNZXN0b0lucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgXCJpbnB1dFtuYW1lPW5hbWUtbmV3LW1lc3RvXVwiXG4pO1xuZXhwb3J0IGNvbnN0IGxpbmtNZXN0b0lucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgXCJpbnB1dFtuYW1lPWxpbmstbmV3LW1lc3RvXVwiXG4pO1xuZXhwb3J0IGNvbnN0IGNhcmRzQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc1wiKTtcbmNvbnN0IHBvcHVwVmlld0ltZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXAtdmlld3MtaW1nXCIpO1xuY29uc3QgcG9wdXBJbWcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19pbWdcIik7XG5jb25zdCBwb3B1cE5hbWVJbWcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19uYW1lLWltZ1wiKTtcblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUNvbnRhaW5lck5ld01lc3RvKFxuICBuYW1lTWVzdG8sXG4gIGxpbmtNZXN0byxcbiAgY2FyZElkLFxuICBhcnJMaWtlcyxcbiAgaWRVc2VyQ2FyZFxuKSB7XG4gIC8v0YTRg9C90LrRhtC40Y8g0YTQvtGA0LzQuNGA0YPQtdGCINC40LcgdGVtcGxhdGUg0LrQsNGA0YLQvtGH0LrRgyDQvNC10YHRgtCwINGBINC00L7QsdCw0LLQu9C10L3QuNC10Lwg0YHQu9GD0YjQsNC10YLQtdC70LXQuSDQutC70LjQutC+0LIg0L3QsCDQuNC60L7QvdC60YMg0YPQtNCw0LvQtdC90LjRjywg0LrQu9C40Log0L/QviDQutCw0YDRgtC40L3QutC1INC00LvRjyDQv9GA0L7RgdC80L7RgtGA0LAg0Lgg0LrQu9C40Log0LvQsNC50LrQsFxuICBjb25zdCBjb250YWluZXJOZXdNZXN0byA9IHRlbXBsYXRlTmV3TWVzdG8uY29udGVudC5jbG9uZU5vZGUodHJ1ZSk7XG4gIGNvbnN0IGNhcmRJbWFnZSA9IGNvbnRhaW5lck5ld01lc3RvLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2ltYWdlXCIpO1xuICBjb25zdCBidXR0b25MaWtlID0gY29udGFpbmVyTmV3TWVzdG8ucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fbGlrZVwiKTtcbiAgY29uc3QgbnVtTGlrZXMgPSBjb250YWluZXJOZXdNZXN0by5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19udW0tbGlrZXNcIik7XG4gIGNvbnN0IGJ1dHRvbkRlbGV0ZSA9IGNvbnRhaW5lck5ld01lc3RvLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2RlbGV0ZVwiKTtcbiAgY2FyZEltYWdlLnNyYyA9IGxpbmtNZXN0bztcbiAgY2FyZEltYWdlLmFsdCA9IG5hbWVNZXN0bztcbiAgY29udGFpbmVyTmV3TWVzdG8ucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fdGl0bGVcIikudGV4dENvbnRlbnQgPSBuYW1lTWVzdG87XG4gIG51bUxpa2VzLnRleHRDb250ZW50ID0gYXJyTGlrZXMubGVuZ3RoO1xuICAvL9C/0YDQvtCy0LXRgNC60LAg0L3QsCDQvdCw0LvQuNGH0LjQtSDRgdCy0L7QuNGFINC70LDQudC60L7QslxuICBpZiAoYXJyTGlrZXMubGVuZ3RoID4gMCkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyTGlrZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChhcnJMaWtlc1tpXS5faWQgPT0gaWRVc2VyKSB7XG4gICAgICAgIGJ1dHRvbkxpa2UuY2xhc3NMaXN0LmFkZChcImNhcmRzX19saWtlX2FjdGl2ZVwiKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIC8v0L/RgNC+0LLQtdGA0LrQsCDQvdCwINC90LDQu9C40YfQuNC1INGB0LLQvtC40YUg0LrQsNGA0YLQvtGH0LXQuiwg0LXRgdC70Lgg0LXRgdGC0YwgLSDQvtGC0L7QsdGA0LDQttCw0LXQvCDQutC90L7Qv9C60YMg0YPQtNCw0LvQuNGC0YxcbiAgaWYgKGlkVXNlckNhcmQgPT0gaWRVc2VyKSB7XG4gICAgYnV0dG9uRGVsZXRlLmNsYXNzTGlzdC5hZGQoXCJjYXJkc19fZGVsZXRlX3Zpc2libGVcIik7XG4gIH1cblxuICBidXR0b25MaWtlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgaWYgKGJ1dHRvbkxpa2UubWF0Y2hlcyhcIi5jYXJkc19fbGlrZV9hY3RpdmVcIikpIHtcbiAgICAgIGRlbGV0ZUxpa2UoY2FyZElkKVxuICAgICAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICAgIG51bUxpa2VzLnRleHRDb250ZW50ID0gZGF0YS5saWtlcy5sZW5ndGg7XG4gICAgICAgICAgZXZ0LnRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKFwiY2FyZHNfX2xpa2VfYWN0aXZlXCIpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBhZGRsaWtlKGNhcmRJZClcbiAgICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICBudW1MaWtlcy50ZXh0Q29udGVudCA9IGRhdGEubGlrZXMubGVuZ3RoO1xuICAgICAgICAgIGV2dC50YXJnZXQuY2xhc3NMaXN0LmFkZChcImNhcmRzX19saWtlX2FjdGl2ZVwiKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIGNvbnRhaW5lck5ld01lc3RvXG4gICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2RlbGV0ZVwiKVxuICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2dCkge1xuICAgICAgZGVsZXRlQ2FyZChjYXJkSWQpXG4gICAgICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgICAgICBldnQudGFyZ2V0LnBhcmVudEVsZW1lbnQucmVtb3ZlKCk7XG4gICAgICAgICAgfSBlbHNlIHJldHVybiBQcm9taXNlLnJlamVjdChg0J7RiNC40LHQutCwOiV7cmVzLnN0YXR1c31gKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICBjb250YWluZXJOZXdNZXN0b1xuICAgIC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19pbWFnZVwiKVxuICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2dCkge1xuICAgICAgcG9wdXBJbWcuc3JjID0gbGlua01lc3RvO1xuICAgICAgcG9wdXBJbWcuYWx0ID0gbmFtZU1lc3RvO1xuICAgICAgcG9wdXBOYW1lSW1nLnRleHRDb250ZW50ID0gbmFtZU1lc3RvO1xuICAgICAgb3BlblBvcHVwKHBvcHVwVmlld0ltZyk7XG4gICAgfSk7XG4gIHJldHVybiBjb250YWluZXJOZXdNZXN0bzsgLy/QstC+0LfRgNCw0YnQsNC10YIg0LPQvtGC0L7QstGD0Y4g0LrQsNGA0YLQvtGH0LrRgyDQtNC70Y8g0LLRgdGC0LDQstC60Lgg0LIgRE9NXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwYXN0TmV3TWVzdG8oXG4gIG5hbWVNZXN0byxcbiAgbGlua01lc3RvLFxuICBjYXJkc0NvbnRhaW5lcixcbiAgY2FyZElkLFxuICBhcnJMaWtlcyxcbiAgaWRVc2VyQ2FyZFxuKSB7XG4gIC8v0LLRgdGC0LDQstC70Y/QtdGCINC30LDQs9C+0YLQvtCy0LvQtdC90L3Rg9GOINC60LDRgNGC0L7Rh9C60YMg0LIgRE9NINCyINGA0L7QtNC40YLQtdC70YwgLmNhcmRzXG4gIGNhcmRzQ29udGFpbmVyLnByZXBlbmQoXG4gICAgY3JlYXRlQ29udGFpbmVyTmV3TWVzdG8obmFtZU1lc3RvLCBsaW5rTWVzdG8sIGNhcmRJZCwgYXJyTGlrZXMsIGlkVXNlckNhcmQpXG4gICk7XG59XG4iLCJpbXBvcnQgXCIuLi9wYWdlcy9pbmRleC5jc3NcIjtcbmltcG9ydCB7IGVuYWJsZVZhbGlkYXRpb24sIHZhbGlkYXRpb25WYXIsIHJlc2V0RXJyb3IgfSBmcm9tIFwiLi92YWxpZGF0ZS5qc1wiO1xuaW1wb3J0IHsgb3BlblBvcHVwLCBjbG9zZVBvcHVwLCBhZGRMaXN0ZW5lclBvcHVwIH0gZnJvbSBcIi4vbW9kYWwuanNcIjtcblxuaW1wb3J0IHtcbiAgbmFtZU1lc3RvSW5wdXQsXG4gIGxpbmtNZXN0b0lucHV0LFxuICBwb3B1cEFkZE1lc3RvLFxuICBwYXN0TmV3TWVzdG8sXG4gIGNhcmRzQ29udGFpbmVyLFxufSBmcm9tIFwiLi9jYXJkLmpzXCI7XG5pbXBvcnQge1xuICBsb2FkQXZhdGFyLFxuICByZWxvYWRBdmF0YXIsXG4gIGdldFVzZXJJbmZvLFxuICBnZXRDYXJkcyxcbiAgcG9zdE5ld0NhcmQsXG4gIHBhdGNoUHJvZmlsZSxcbn0gZnJvbSBcIi4vYXBpXCI7XG5pbXBvcnQgeyByZW5kZXJMb2FkaW5nIH0gZnJvbSBcIi4vdXRpbHNcIjtcblxuZXhwb3J0IGNvbnN0IGZvcm1BZGRNZXN0byA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJmb3JtW25hbWU9YWRkLW5ldy1tZXN0b11cIik7XG5jb25zdCBidXR0b25BZGRNZXN0byA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ1dHRvblwiKTtcbmNvbnN0IGJ1dHRvbkVkaXRQcm9maWxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ1dHRvblwiKTtcbmNvbnN0IGJ1dHRvbnNDbG9zZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucG9wdXBfX2ljb24tY2xvc2VcIik7XG5jb25zdCBmb3JtRWRpdFVzZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdmb3JtW25hbWU9XCJlZGl0LXVzZXJcIl0nKTtcbmNvbnN0IGJ1dHRvblNhdmVNZXN0byA9IHBvcHVwQWRkTWVzdG8ucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fYnV0dG9uLXNhdmVcIik7XG5leHBvcnQgY29uc3QgcHJvZmlsZVVzZXJOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX191c2VyLW5hbWVcIik7XG5leHBvcnQgY29uc3QgcHJvZmlsZVVzZXJBYm91dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fdXNlci1hYm91dFwiKTtcbmV4cG9ydCBjb25zdCBwb3B1cEVkaXRQcm9maWxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlLXBvcHVwXCIpO1xuY29uc3QgbmFtZUlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImlucHV0W25hbWU9bmFtZS11c2VyXVwiKTtcbmNvbnN0IGFib3V0SW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiaW5wdXRbbmFtZT1hYm91dC11c2VyXVwiKTtcbmV4cG9ydCBjb25zdCBwb3B1cEVkaXRBdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmF2YXRhci1wb3B1cFwiKTtcbmNvbnN0IGZvcm1FZGl0QXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImZvcm1bbmFtZT1lZGl0LWF2YXRhcl1cIik7XG5jb25zdCBuZXdBdmF0YXJJbnB1dCA9IGZvcm1FZGl0QXZhdGFyLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiaW5wdXRbbmFtZT1pbnB1dC1saW5rLWF2YXRhcl1cIlxuKTtcbmNvbnN0IGF2YXRhckltZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyXCIpO1xuY29uc3QgYnV0dG9uTmV3QXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19idXR0b24tYXZhdGFyLWVkaXRcIik7XG5leHBvcnQgbGV0IGlkVXNlciA9IFwiXCI7XG5sZXQgaW5pdGlhbENhcmRzID0ge307XG5jb25zdCBidXR0b25TYXZlUHJvZmlsZSA9IGZvcm1FZGl0VXNlci5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19idXR0b24tc2F2ZVwiKTtcbmNvbnN0IGJ1dHRvblNhdmVBdmF0YXIgPSBwb3B1cEVkaXRBdmF0YXIucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fYnV0dG9uLXNhdmVcIik7XG5lbmFibGVWYWxpZGF0aW9uKHZhbGlkYXRpb25WYXIpO1xuYWRkTGlzdGVuZXJQb3B1cCgpO1xuXG5Qcm9taXNlLmFsbChbZ2V0VXNlckluZm8oKSwgbG9hZEF2YXRhcigpLCBnZXRDYXJkcygpXSlcbiAgLnRoZW4oKFt1c2VySW5mbywgYXZhdGFyLCBjYXJkc10pID0+IHtcbiAgICBwcm9maWxlVXNlck5hbWUudGV4dENvbnRlbnQgPSB1c2VySW5mby5uYW1lO1xuICAgIHByb2ZpbGVVc2VyQWJvdXQudGV4dENvbnRlbnQgPSB1c2VySW5mby5hYm91dDtcbiAgICBpZFVzZXIgPSB1c2VySW5mby5faWQ7XG4gICAgYXZhdGFySW1nLnNyYyA9IGF2YXRhci5hdmF0YXI7XG4gICAgaW5pdGlhbENhcmRzID0gY2FyZHM7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbml0aWFsQ2FyZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHBhc3ROZXdNZXN0byhcbiAgICAgICAgaW5pdGlhbENhcmRzW2luaXRpYWxDYXJkcy5sZW5ndGggLSBpIC0gMV0ubmFtZSxcbiAgICAgICAgaW5pdGlhbENhcmRzW2luaXRpYWxDYXJkcy5sZW5ndGggLSBpIC0gMV0ubGluayxcbiAgICAgICAgY2FyZHNDb250YWluZXIsXG4gICAgICAgIGluaXRpYWxDYXJkc1tpbml0aWFsQ2FyZHMubGVuZ3RoIC0gaSAtIDFdLl9pZCxcbiAgICAgICAgaW5pdGlhbENhcmRzW2luaXRpYWxDYXJkcy5sZW5ndGggLSBpIC0gMV0ubGlrZXMsXG4gICAgICAgIGluaXRpYWxDYXJkc1tpbml0aWFsQ2FyZHMubGVuZ3RoIC0gaSAtIDFdLm93bmVyLl9pZFxuICAgICAgKTtcbiAgICB9XG4gIH0pXG4gIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKTtcblxuZm9ybUVkaXRVc2VyLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgcmVuZGVyTG9hZGluZyhcItCh0L7RhdGA0LDQvdC10L3QuNC1XCIsIFwi0KHQvtGF0YDQsNC90LjRgtGMXCIsIHRydWUsIGJ1dHRvblNhdmVQcm9maWxlKTtcbiAgcGF0Y2hQcm9maWxlKG5hbWVJbnB1dCwgYWJvdXRJbnB1dClcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgcHJvZmlsZVVzZXJOYW1lLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICAgICAgcHJvZmlsZVVzZXJBYm91dC50ZXh0Q29udGVudCA9IGRhdGEuYWJvdXQ7XG4gICAgICBjbG9zZVBvcHVwKHBvcHVwRWRpdFByb2ZpbGUpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgfSlcbiAgICAuZmluYWxseSgoKSA9PlxuICAgICAgcmVuZGVyTG9hZGluZyhcItCh0L7RhdGA0LDQvdC10L3QuNC1Li4uXCIsIFwi0KHQvtGF0YDQsNC90LjRgtGMXCIsIGZhbHNlLCBidXR0b25TYXZlUHJvZmlsZSlcbiAgICApO1xufSk7XG5cbmJ1dHRvbnNDbG9zZS5mb3JFYWNoKChidXR0b24pID0+IHtcbiAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBjbG9zZVBvcHVwKTtcbn0pO1xuXG5idXR0b25FZGl0UHJvZmlsZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBuYW1lSW5wdXQudmFsdWUgPSBwcm9maWxlVXNlck5hbWUudGV4dENvbnRlbnQ7XG4gIGFib3V0SW5wdXQudmFsdWUgPSBwcm9maWxlVXNlckFib3V0LnRleHRDb250ZW50O1xuICBvcGVuUG9wdXAocG9wdXBFZGl0UHJvZmlsZSk7XG4gIHJlc2V0RXJyb3IoXG4gICAgcG9wdXBFZGl0UHJvZmlsZSxcbiAgICB2YWxpZGF0aW9uVmFyLmlucHV0U2VsZWN0b3IsXG4gICAgdmFsaWRhdGlvblZhci5zdWJtaXRCdXR0b25TZWxlY3RvcixcbiAgICB2YWxpZGF0aW9uVmFyLmluYWN0aXZlQnV0dG9uQ2xhc3NcbiAgKTtcbn0pO1xuXG5idXR0b25BZGRNZXN0by5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBuYW1lTWVzdG9JbnB1dC52YWx1ZSA9IFwiXCI7XG4gIGxpbmtNZXN0b0lucHV0LnZhbHVlID0gXCJcIjtcbiAgb3BlblBvcHVwKHBvcHVwQWRkTWVzdG8pO1xuICByZXNldEVycm9yKFxuICAgIHBvcHVwQWRkTWVzdG8sXG4gICAgdmFsaWRhdGlvblZhci5pbnB1dFNlbGVjdG9yLFxuICAgIHZhbGlkYXRpb25WYXIuc3VibWl0QnV0dG9uU2VsZWN0b3IsXG4gICAgdmFsaWRhdGlvblZhci5pbmFjdGl2ZUJ1dHRvbkNsYXNzXG4gICk7XG59KTtcblxuZm9ybUFkZE1lc3RvLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgcmVuZGVyTG9hZGluZyhcItCh0L7RhdGA0LDQvdC10L3QuNC1Li4uXCIsIFwi0KHQvtC30LTQsNGC0YxcIiwgdHJ1ZSwgYnV0dG9uU2F2ZU1lc3RvKTtcbiAgcG9zdE5ld0NhcmQobmFtZU1lc3RvSW5wdXQsIGxpbmtNZXN0b0lucHV0KVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBwYXN0TmV3TWVzdG8oXG4gICAgICAgIGRhdGEubmFtZSxcbiAgICAgICAgZGF0YS5saW5rLFxuICAgICAgICBjYXJkc0NvbnRhaW5lcixcbiAgICAgICAgZGF0YS5faWQsXG4gICAgICAgIFtdLFxuICAgICAgICBkYXRhLm93bmVyLl9pZFxuICAgICAgKTtcbiAgICAgIGNsb3NlUG9wdXAocG9wdXBBZGRNZXN0byk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICB9KVxuICAgIC5maW5hbGx5KCgpID0+XG4gICAgICByZW5kZXJMb2FkaW5nKFwi0KHQvtGF0YDQsNC90LXQvdC40LUuLi5cIiwgXCLQodC+0LfQtNCw0YLRjFwiLCBmYWxzZSwgYnV0dG9uU2F2ZU1lc3RvKVxuICAgICk7XG59KTtcblxuYnV0dG9uTmV3QXZhdGFyLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIG5ld0F2YXRhcklucHV0LnZhbHVlID0gXCJcIjtcbiAgb3BlblBvcHVwKHBvcHVwRWRpdEF2YXRhcik7XG4gIHJlc2V0RXJyb3IoXG4gICAgcG9wdXBFZGl0QXZhdGFyLFxuICAgIHZhbGlkYXRpb25WYXIuaW5wdXRTZWxlY3RvcixcbiAgICB2YWxpZGF0aW9uVmFyLnN1Ym1pdEJ1dHRvblNlbGVjdG9yLFxuICAgIHZhbGlkYXRpb25WYXIuaW5hY3RpdmVCdXR0b25DbGFzc1xuICApO1xufSk7XG5cbmZvcm1FZGl0QXZhdGFyLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgcmVuZGVyTG9hZGluZyhcItCh0L7RhdGA0LDQvdC10L3QuNC1Li4uXCIsIFwi0KHQvtGF0YDQsNC90LjRgtGMXCIsIHRydWUsIGJ1dHRvblNhdmVBdmF0YXIpO1xuICByZWxvYWRBdmF0YXIobmV3QXZhdGFySW5wdXQpXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIGF2YXRhckltZy5zcmMgPSBkYXRhLmF2YXRhcjtcbiAgICAgIGNsb3NlUG9wdXAocG9wdXBFZGl0QXZhdGFyKTtcbiAgICB9KVxuICAgIC5jYXRjaCgocmVzKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhyZXMpO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoKCkgPT5cbiAgICAgIHJlbmRlckxvYWRpbmcoXCLQodC+0YXRgNCw0L3QtdC90LjQtS4uLlwiLCBcItCh0L7RhdGA0LDQvdC40YLRjFwiLCBmYWxzZSwgYnV0dG9uU2F2ZUF2YXRhcilcbiAgICApO1xufSk7XG4iXSwibmFtZXMiOlsiX193ZWJwYWNrX3JlcXVpcmVfXyIsImV4cG9ydHMiLCJkZWZpbml0aW9uIiwia2V5IiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJ2YWxpZGF0aW9uVmFyIiwiZm9ybVNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsImVycm9yQ2xhc3MiLCJoaWRlSW5wdXRFcnIiLCJmb3JtRWwiLCJpbnB1dEVsIiwiY2xhc3NFcnJvckFjdGl2ZSIsImNsYXNzSW5wdXRFcnJvciIsImVyckVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiaWQiLCJ0ZXh0Q29udGVudCIsImNsYXNzTGlzdCIsInJlbW92ZSIsInJlc2V0RXJyb3IiLCJpbnB1dExpc3QiLCJBcnJheSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwiYnV0dG9uRWwiLCJmb3JFYWNoIiwiZGlzYWJsZVN1Ym1pdEJ1dHRvbiIsImFkZCIsImJ1dHRvbkVsZW1lbnQiLCJkaXNhYmxlZCIsImxpc3RQb3B1cCIsImRvY3VtZW50Iiwib3BlblBvcHVwIiwicG9wdXAiLCJhZGRFdmVudExpc3RlbmVyIiwiY2hlY2tLZXlFc2NhcGUiLCJjbG9zZVBvcHVwIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImV2dCIsImNoZWNrUmVzcG9uc2UiLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwicmVuZGVyTG9hZGluZyIsInRleHRMb2FkaW5nIiwidGVzdFN0YW5kYXJ0IiwiYnV0dG9uU3RhdHVzIiwiYnV0dG9uIiwiY29uZmlnIiwiYmFzZVVybCIsImNhcmRzVXJsIiwibGlrZXNVcmwiLCJhdmF0YXJVcmwiLCJoZWFkZXJzIiwiYXV0aG9yaXphdGlvbiIsInRlbXBsYXRlTmV3TWVzdG8iLCJwb3B1cEFkZE1lc3RvIiwibmFtZU1lc3RvSW5wdXQiLCJsaW5rTWVzdG9JbnB1dCIsImNhcmRzQ29udGFpbmVyIiwicG9wdXBWaWV3SW1nIiwicG9wdXBJbWciLCJwb3B1cE5hbWVJbWciLCJwYXN0TmV3TWVzdG8iLCJuYW1lTWVzdG8iLCJsaW5rTWVzdG8iLCJjYXJkSWQiLCJhcnJMaWtlcyIsImlkVXNlckNhcmQiLCJwcmVwZW5kIiwiY29udGFpbmVyTmV3TWVzdG8iLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiY2FyZEltYWdlIiwiYnV0dG9uTGlrZSIsIm51bUxpa2VzIiwiYnV0dG9uRGVsZXRlIiwic3JjIiwiYWx0IiwibGVuZ3RoIiwiaSIsIl9pZCIsImlkVXNlciIsIm1hdGNoZXMiLCJmZXRjaCIsIm1ldGhvZCIsInRoZW4iLCJkZWxldGVMaWtlIiwiZGF0YSIsImxpa2VzIiwidGFyZ2V0IiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwibG9nIiwiYWRkbGlrZSIsImRlbGV0ZUNhcmQiLCJwYXJlbnRFbGVtZW50IiwiY3JlYXRlQ29udGFpbmVyTmV3TWVzdG8iLCJmb3JtQWRkTWVzdG8iLCJidXR0b25BZGRNZXN0byIsImJ1dHRvbkVkaXRQcm9maWxlIiwiYnV0dG9uc0Nsb3NlIiwiZm9ybUVkaXRVc2VyIiwiYnV0dG9uU2F2ZU1lc3RvIiwicHJvZmlsZVVzZXJOYW1lIiwicHJvZmlsZVVzZXJBYm91dCIsInBvcHVwRWRpdFByb2ZpbGUiLCJuYW1lSW5wdXQiLCJhYm91dElucHV0IiwicG9wdXBFZGl0QXZhdGFyIiwiZm9ybUVkaXRBdmF0YXIiLCJuZXdBdmF0YXJJbnB1dCIsImF2YXRhckltZyIsImJ1dHRvbk5ld0F2YXRhciIsImluaXRpYWxDYXJkcyIsImJ1dHRvblNhdmVQcm9maWxlIiwiYnV0dG9uU2F2ZUF2YXRhciIsInRvZ2dsZUJ1dHRvbiIsInNvbWUiLCJ2YWxpZGl0eSIsInZhbGlkIiwiZmluZEludmFsaWRJbnB1dCIsInBhdHRlcm5NaXNtYXRjaCIsInNldEN1c3RvbVZhbGlkaXR5IiwiZGF0YXNldCIsImVycm9yTWVzc2FnZSIsIkVyck1lc3NhZ2UiLCJzaG93SW5wdXRFcnIiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsImNoZWNrVmFsaWQiLCJhZGRGb3JtTGlzdGVuZXIiLCJlbmFibGVWYWxpZGF0aW9uIiwicG9wdXBFbCIsImNvbnRhaW5zIiwiYWxsIiwidXNlckluZm8iLCJhdmF0YXIiLCJjYXJkcyIsIm5hbWUiLCJhYm91dCIsImxpbmsiLCJvd25lciIsInByZXZlbnREZWZhdWx0IiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ2YWx1ZSIsInBhdGNoUHJvZmlsZSIsImZpbmFsbHkiLCJwb3N0TmV3Q2FyZCIsInJlbG9hZEF2YXRhciJdLCJzb3VyY2VSb290IjoiIn0=